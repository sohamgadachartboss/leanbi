<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Dashboard</title>
    <link rel="stylesheet" href="https://sohamgadachartboss.github.io/leanbi/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
</head>

<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <h1>Dashboard</h1>

        <!-- Edit Mode Toggle -->
        <div class="toggle-container">
            <span class="toggle-label">Edit Mode:</span>
            <label class="toggle-switch">
                <input type="checkbox" id="editModeToggle">
                <span class="toggle-slider"></span>
            </label>
        </div>

        <!-- Save Edit Button -->
        <button class="save-edit-btn" id="saveEditBtn">Save Edit</button>

        <!-- Tab Selector -->
        <div class="tab-selector" id="tabSelector">
            <!-- Radio buttons will be generated dynamically -->
        </div>
    </div>

    <!-- Working Area -->
    <div class="working-area">
        <div id="gridContainer" class="grid-container">
            <canvas class="grid-background" id="gridCanvas"></canvas>
            <div class="edit-overlay" id="editOverlay"></div>
            <!-- Components will be rendered here -->
        </div>
    </div>

    <script>
        // Embed the spec JSON
        const SPEC = {
            "overview": [
                "Provide visibility into department-level recruitment pipeline and hiring progress across 5-10 concurrent open positions",
                "Enable data-driven decisions to reduce time-to-hire by identifying bottlenecks and optimizing resource allocation",
                "Streamline recruitment status reporting and support proactive pipeline management"
            ],
            "filters": [
                {
                    "field": "date_range",
                    "type": "date_range",
                    "applies_to": "all"
                },
                {
                    "field": "position_requisition",
                    "type": "multi_select",
                    "applies_to": "all"
                },
                {
                    "field": "hiring_manager",
                    "type": "multi_select",
                    "applies_to": "all"
                },
                {
                    "field": "position_priority",
                    "type": "multi_select",
                    "applies_to": "all"
                }
            ],
            "users": [
                "HR Manager (Department-level)",
                "Department Leadership",
                "Hiring Managers",
                "Recruiters"
            ],
            "tab_1": {
                "rows": 12,
                "columns": 8,
                "total_comps": 7,
                "tab_1_comp_1": {
                    "data_question": "How many positions are currently open and actively being recruited for?",
                    "decision": "Workload assessment, resource allocation, and stakeholder communication on hiring volume",
                    "representation_type": "KPI",
                    "micro_prompt": "Create a KPI card displaying the total number of open positions. Show the value '8' prominently in large text with the label 'Open Positions' below it. Include a small subtitle showing '2 High Priority' in amber/orange color beneath the main value.",
                    "data": {
                        "value": 8,
                        "label": "Open Positions",
                        "subtitle": "2 High Priority",
                        "breakdown": {
                            "high_priority": 2,
                            "medium_priority": 4,
                            "low_priority": 2
                        }
                    },
                    "position": "Tab1!R1C1",
                    "width": 2,
                    "height": 2,
                    "dom_id": "tab_1_comp_1",
                    "config": {
                        "type": "kpi",
                        "title": "Open Positions",
                        "value": 8,
                        "subtitle": "2 High Priority",
                        "subtitle_color": "#f59e0b"
                    },
                    "importance": 3,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                },
                "tab_1_comp_2": {
                    "data_question": "How many candidates are currently active in our pipeline across all stages?",
                    "decision": "Assess whether sourcing efforts are sufficient; identify if pipeline is too thin or adequately stocked",
                    "representation_type": "KPI",
                    "micro_prompt": "Create a KPI card showing the total number of active candidates in the pipeline. Display the value '127' prominently with the label 'Active Candidates' below. Include a small green upward arrow with '+18' to indicate growth from the previous period.",
                    "data": {
                        "value": 127,
                        "label": "Active Candidates",
                        "change": "+18",
                        "change_label": "vs last month",
                        "previous": 109
                    },
                    "position": "Tab1!R1C3",
                    "width": 2,
                    "height": 2,
                    "dom_id": "tab_1_comp_2",
                    "config": {
                        "type": "kpi",
                        "title": "Active Candidates",
                        "value": 127,
                        "change": "+18",
                        "trend": "up",
                        "comparison": "vs last month",
                        "previous": 109
                    },
                    "importance": 3,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                },
                "tab_1_comp_3": {
                    "data_question": "What is the average number of days from position opening to offer acceptance?",
                    "decision": "Identify if hiring process is too slow; justify process improvements; benchmark against targets",
                    "representation_type": "KPI",
                    "micro_prompt": "Create a KPI card displaying average time-to-hire. Show the value '42 days' prominently with the label 'Avg Time-to-Hire' below. Include a horizontal reference indicator showing 'Target: 35 days' in gray, and a red downward arrow with '-7 days' indicating the gap from target.",
                    "data": {
                        "value": 42,
                        "label": "Avg Time-to-Hire",
                        "unit": "days",
                        "target": 35,
                        "gap": 7,
                        "previous_period": 45
                    },
                    "position": "Tab1!R1C5",
                    "width": 2,
                    "height": 2,
                    "dom_id": "tab_1_comp_3",
                    "config": {
                        "type": "kpi",
                        "title": "Avg Time-to-Hire",
                        "value": 42,
                        "unit": "days",
                        "target": 35,
                        "gap": 7,
                        "trend": "down",
                        "comparison": "Target: 35 days"
                    },
                    "importance": 3,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                },
                "tab_1_comp_4": {
                    "data_question": "What percentage of offers extended are being accepted by candidates?",
                    "decision": "Identify if offer strategy needs adjustment; flag potential compensation competitiveness issues",
                    "representation_type": "KPI",
                    "micro_prompt": "Create a KPI card showing offer acceptance rate. Display '78%' prominently with the label 'Offer Acceptance Rate' below. Include a small red downward arrow with '-8%' to show decline from previous period, and a subtitle '14 of 18 offers accepted' in smaller text.",
                    "data": {
                        "value": 78,
                        "label": "Offer Acceptance Rate",
                        "unit": "%",
                        "change": -8,
                        "offers_extended": 18,
                        "offers_accepted": 14,
                        "previous_rate": 86
                    },
                    "position": "Tab1!R1C7",
                    "width": 2,
                    "height": 2,
                    "dom_id": "tab_1_comp_4",
                    "config": {
                        "type": "kpi",
                        "title": "Offer Acceptance Rate",
                        "value": 78,
                        "unit": "%",
                        "change": "-8%",
                        "trend": "down",
                        "subtitle": "14 of 18 offers accepted",
                        "previous": 86
                    },
                    "importance": 3,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                },
                "tab_1_comp_5": {
                    "data_question": "How many candidates are at each stage of the recruitment process, and what are the conversion rates between stages?",
                    "decision": "Identify which stages need process improvement; assess if sourcing volume is sufficient; spot conversion rate problems",
                    "representation_type": "Chart",
                    "micro_prompt": "Create a horizontal bar chart showing the recruitment funnel. X-axis shows the number of candidates (0-120), Y-axis lists recruitment stages from top to bottom: 'Applied', 'Phone Screen', 'Technical Interview', 'Manager Interview', 'Offer', 'Accepted'. Each bar should display the candidate count at that stage. Add conversion rate percentages as labels on or near each bar (e.g., '65%' between Applied and Phone Screen). Use a blue color gradient where bars get progressively darker as stages advance.",
                    "data": {
                        "stages": ["Applied", "Phone Screen", "Technical Interview", "Manager Interview", "Offer", "Accepted"],
                        "candidates": [112, 73, 45, 28, 18, 14],
                        "conversion_rates": [65, 62, 62, 64, 78],
                        "labels": {
                            "x": "Number of Candidates",
                            "y": "Recruitment Stage"
                        }
                    },
                    "position": "Tab1!R3C1",
                    "width": 4,
                    "height": 4,
                    "dom_id": "tab_1_comp_5",
                    "config": {
                        "type": "bar",
                        "data": {
                            "labels": ["Applied", "Phone Screen", "Technical Interview", "Manager Interview", "Offer", "Accepted"],
                            "datasets": [{
                                "label": "Candidates",
                                "data": [112, 73, 45, 28, 18, 14],
                                "backgroundColor": ["#3b82f6", "#2563eb", "#1d4ed8", "#1e40af", "#1e3a8a", "#172554"]
                            }]
                        },
                        "options": {
                            "indexAxis": "y",
                            "responsive": true,
                            "maintainAspectRatio": false,
                            "plugins": {
                                "legend": {
                                    "display": false
                                },
                                "title": {
                                    "display": true,
                                    "text": "Recruitment Funnel"
                                }
                            },
                            "scales": {
                                "x": {
                                    "beginAtZero": true,
                                    "max": 120,
                                    "title": {
                                        "display": true,
                                        "text": "Number of Candidates"
                                    }
                                },
                                "y": {
                                    "title": {
                                        "display": true,
                                        "text": "Recruitment Stage"
                                    }
                                }
                            }
                        }
                    },
                    "importance": 3,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                },
                "tab_1_comp_6": {
                    "data_question": "Which positions have the longest vs. shortest time-to-hire, and by how much?",
                    "decision": "Prioritize attention on positions with excessive time-to-hire; learn from fast-hiring positions",
                    "representation_type": "Chart",
                    "micro_prompt": "Create a horizontal bar chart comparing time-to-hire across positions. X-axis shows days (0-60), Y-axis lists position titles. Include a vertical dashed red line at 35 days representing the target time-to-hire. Bars exceeding the target should be in red, bars meeting or below target in green. Display the exact number of days at the end of each bar.",
                    "data": {
                        "positions": ["Senior Developer", "Product Manager", "UX Designer", "Data Analyst", "Sales Rep", "Marketing Manager"],
                        "time_to_hire": [58, 52, 38, 31, 28, 35],
                        "target": 35,
                        "labels": {
                            "x": "Days to Hire",
                            "y": "Position"
                        }
                    },
                    "position": "Tab1!R3C5",
                    "width": 4,
                    "height": 4,
                    "dom_id": "tab_1_comp_6",
                    "config": {
                        "type": "bar",
                        "data": {
                            "labels": ["Senior Developer", "Product Manager", "UX Designer", "Data Analyst", "Sales Rep", "Marketing Manager"],
                            "datasets": [{
                                "label": "Days to Hire",
                                "data": [58, 52, 38, 31, 28, 35],
                                "backgroundColor": ["#ef4444", "#ef4444", "#ef4444", "#10b981", "#10b981", "#10b981"]
                            }]
                        },
                        "options": {
                            "indexAxis": "y",
                            "responsive": true,
                            "maintainAspectRatio": false,
                            "plugins": {
                                "legend": {
                                    "display": false
                                },
                                "title": {
                                    "display": true,
                                    "text": "Time-to-Hire by Position"
                                }
                            },
                            "scales": {
                                "x": {
                                    "beginAtZero": true,
                                    "max": 60,
                                    "title": {
                                        "display": true,
                                        "text": "Days to Hire"
                                    }
                                },
                                "y": {
                                    "title": {
                                        "display": true,
                                        "text": "Position"
                                    }
                                }
                            }
                        }
                    },
                    "importance": 2,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                },
                "tab_1_comp_7": {
                    "data_question": "What is the detailed status of each open position, including candidate counts at each stage?",
                    "decision": "Deep-dive into specific position status; prepare for stakeholder meetings; identify which positions need immediate action",
                    "representation_type": "Table",
                    "micro_prompt": "Create a detailed table showing position-level recruitment status. Columns: 'Position Title', 'Hiring Manager', 'Days Open', 'Applied', 'Phone Screen', 'Interview', 'Offer', 'Priority'. Include 8 rows of position data. Apply conditional formatting: Priority column should show 'High' in red, 'Medium' in amber, 'Low' in gray. Days Open over 45 should be highlighted in light red background.",
                    "data": {
                        "columns": ["Position Title", "Hiring Manager", "Days Open", "Applied", "Phone Screen", "Interview", "Offer", "Priority"],
                        "rows": [
                            ["Senior Developer", "Sarah Chen", 58, 24, 15, 8, 2, "High"],
                            ["Product Manager", "Mike Johnson", 52, 18, 12, 6, 1, "High"],
                            ["UX Designer", "Lisa Park", 38, 16, 10, 5, 2, "Medium"],
                            ["Data Analyst", "Tom Wilson", 31, 14, 9, 4, 1, "Medium"],
                            ["Sales Rep", "Amy Roberts", 28, 12, 8, 3, 1, "Low"],
                            ["Marketing Manager", "David Lee", 35, 10, 6, 2, 0, "Medium"]
                        ]
                    },
                    "position": "Tab1!R7C1",
                    "width": 8,
                    "height": 4,
                    "dom_id": "tab_1_comp_7",
                    "config": {
                        "type": "table",
                        "columns": ["Position Title", "Hiring Manager", "Days Open", "Applied", "Phone Screen", "Interview", "Offer", "Priority"],
                        "rows": [
                            ["Senior Developer", "Sarah Chen", 58, 24, 15, 8, 2, "High"],
                            ["Product Manager", "Mike Johnson", 52, 18, 12, 6, 1, "High"],
                            ["UX Designer", "Lisa Park", 38, 16, 10, 5, 2, "Medium"],
                            ["Data Analyst", "Tom Wilson", 31, 14, 9, 4, 1, "Medium"],
                            ["Sales Rep", "Amy Roberts", 28, 12, 8, 3, 1, "Low"],
                            ["Marketing Manager", "David Lee", 35, 10, 6, 2, 0, "Medium"]
                        ]
                    },
                    "importance": 2,
                    "cost": {
                        "financial": 0,
                        "effort": 0,
                        "date": 0
                    }
                }
            },
            "tab_2": {
                "rows": 0,
                "columns": 0,
                "total_comps": 0
            }
        }
    </script>
    <script src="https://sohamgadachartboss.github.io/leanbi/layout_logic.js"></script>

    <script>
        // Initialize all components (Charts, KPIs, Tables) after layout renders
        function initializeComponents() {
            Object.keys(SPEC).forEach(key => {
                if (key.startsWith('tab_')) {
                    const tab = SPEC[key];
                    Object.keys(tab).forEach(compKey => {
                        if (compKey.startsWith('tab_') && compKey.includes('_comp_')) {
                            const comp = tab[compKey];
                            if (!comp.config || !comp.config.type) return;

                            const container = document.getElementById(compKey);
                            if (!container) return;

                            const contentArea = container.querySelector('.component-content');
                            if (!contentArea) return;

                            const configType = comp.config.type;

                            // Render based on component type
                            if (['bar', 'line', 'pie', 'doughnut'].includes(configType)) {
                                renderChart(contentArea, compKey, comp.config);
                            } else if (configType === 'kpi') {
                                renderKPI(contentArea, comp.config);
                            } else if (configType === 'table') {
                                renderTable(contentArea, comp.config);
                            }
                        }
                    });
                }
            });
        }

        // Render Chart.js chart
        function renderChart(contentArea, domId, config) {
            contentArea.innerHTML = '';
            const canvas = document.createElement('canvas');
            canvas.id = domId + '_chart';
            contentArea.appendChild(canvas);

            new Chart(canvas, {
                type: config.type,
                data: config.data,
                options: config.options
            });
        }

        // Render KPI card
        function renderKPI(contentArea, config) {
            contentArea.innerHTML = '';
            const kpiDiv = document.createElement('div');
            kpiDiv.className = 'kpi-container';
            kpiDiv.style.cssText = 'display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:10px;text-align:center;';

            // Value with unit
            const valueDiv = document.createElement('div');
            valueDiv.style.cssText = 'font-size:2em;font-weight:bold;color:#1f2937;';
            const unit = config.unit || '';
            const value = config.value;
            valueDiv.textContent = unit === '$' ? `$${value.toLocaleString()}` : unit === '%' ? `${value}%` : `${value}${unit ? ' ' + unit : ''}`;
            kpiDiv.appendChild(valueDiv);

            // Title
            const titleDiv = document.createElement('div');
            titleDiv.style.cssText = 'font-size:0.9em;color:#6b7280;margin-top:4px;';
            titleDiv.textContent = config.title || '';
            kpiDiv.appendChild(titleDiv);

            // Change indicator
            if (config.change) {
                const changeDiv = document.createElement('div');
                const isPositive = config.trend === 'up' || (typeof config.change === 'string' && config.change.startsWith('+'));
                changeDiv.style.cssText = `font-size:0.85em;margin-top:8px;color:${isPositive ? '#10b981' : '#ef4444'};`;
                const arrow = isPositive ? '↑' : '↓';
                changeDiv.textContent = `${arrow} ${config.change}`;
                if (config.comparison) {
                    changeDiv.textContent += ` ${config.comparison}`;
                }
                kpiDiv.appendChild(changeDiv);
            }

            // Subtitle
            if (config.subtitle) {
                const subtitleDiv = document.createElement('div');
                subtitleDiv.style.cssText = `font-size:0.8em;margin-top:4px;color:${config.subtitle_color || '#6b7280'};`;
                subtitleDiv.textContent = config.subtitle;
                kpiDiv.appendChild(subtitleDiv);
            }

            contentArea.appendChild(kpiDiv);
        }

        // Render Table
        function renderTable(contentArea, config) {
            contentArea.innerHTML = '';
            const tableWrapper = document.createElement('div');
            tableWrapper.style.cssText = 'width:100%;height:100%;overflow:auto;';

            const table = document.createElement('table');
            table.style.cssText = 'width:100%;border-collapse:collapse;font-size:0.8em;';

            // Header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            (config.columns || []).forEach(col => {
                const th = document.createElement('th');
                th.style.cssText = 'padding:8px;text-align:left;border-bottom:2px solid #e5e7eb;background:#f9fafb;font-weight:600;color:#374151;';
                th.textContent = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Body
            const tbody = document.createElement('tbody');
            (config.rows || []).forEach(row => {
                const tr = document.createElement('tr');
                row.forEach((cell, idx) => {
                    const td = document.createElement('td');
                    td.style.cssText = 'padding:8px;border-bottom:1px solid #e5e7eb;color:#4b5563;';
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);

            tableWrapper.appendChild(table);
            contentArea.appendChild(tableWrapper);
        }

        // Wait for layout to render, then initialize components
        const observer = new MutationObserver((mutations, obs) => {
            const gridContainer = document.getElementById('gridContainer');
            if (gridContainer && gridContainer.querySelector('.component')) {
                setTimeout(initializeComponents, 100);
                obs.disconnect();
            }
        });

        observer.observe(document.body, { childList: true, subtree: true });
        window.addEventListener('load', () => setTimeout(initializeComponents, 500));
    </script>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
</body>

</html>
