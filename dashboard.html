<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Dashboard</title>
    <link rel="stylesheet" href="https://sohamgadachartboss.github.io/leanbi/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
</head>

<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <h1>Dashboard</h1>

        <!-- Edit Mode Toggle -->
        <div class="toggle-container">
            <span class="toggle-label">Edit Mode:</span>
            <label class="toggle-switch">
                <input type="checkbox" id="editModeToggle">
                <span class="toggle-slider"></span>
            </label>
        </div>

        <!-- Save Edit Button -->
        <button class="save-edit-btn" id="saveEditBtn">Save Edit</button>

        <!-- Tab Selector -->
        <div class="tab-selector" id="tabSelector">
            <!-- Radio buttons will be generated dynamically -->
        </div>
    </div>

    <!-- Working Area -->
    <div class="working-area">
        <div id="gridContainer" class="grid-container">
            <canvas class="grid-background" id="gridCanvas"></canvas>
            <div class="edit-overlay" id="editOverlay"></div>
            <!-- Components will be rendered here -->
        </div>
    </div>

    <script>
        // Embed the spec JSON
        const SPEC = {}
    </script>
    <script src="https://sohamgadachartboss.github.io/leanbi/layout_logic.js"></script>

    <script>
        // Initialize Chart.js charts after layout renders
        function initializeCharts() {
            const chartConfigs = [];

            // Find all chart components in the SPEC
            Object.keys(SPEC).forEach(key => {
                if (key.startsWith('tab_')) {
                    const tab = SPEC[key];
                    Object.keys(tab).forEach(compKey => {
                        if (compKey.startsWith('tab_') && compKey.includes('_comp_')) {
                            const comp = tab[compKey];
                            if (comp.config && ['bar', 'line', 'pie', 'doughnut'].includes(comp.config.type)) {
                                chartConfigs.push({
                                    domId: compKey,
                                    config: comp.config
                                });
                            }
                        }
                    });
                }
            });

            // Create charts
            chartConfigs.forEach(({ domId, config }) => {
                const container = document.getElementById(domId);
                if (!container) return;

                const contentArea = container.querySelector('.component-content');
                if (!contentArea) return;

                contentArea.innerHTML = '';
                const canvas = document.createElement('canvas');
                canvas.id = domId + '_chart';
                contentArea.appendChild(canvas);

                new Chart(canvas, {
                    type: config.type,
                    data: config.data,
                    options: config.options
                });
            });
        }

        // Wait for layout to render, then initialize charts
        const observer = new MutationObserver((mutations, obs) => {
            const gridContainer = document.getElementById('gridContainer');
            if (gridContainer && gridContainer.querySelector('.component')) {
                setTimeout(initializeCharts, 100);
                obs.disconnect();
            }
        });

        observer.observe(document.body, { childList: true, subtree: true });
        window.addEventListener('load', () => setTimeout(initializeCharts, 500));
    </script>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
</body>

</html>
